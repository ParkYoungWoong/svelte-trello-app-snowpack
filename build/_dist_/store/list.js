import{writable as m}from"../../web_modules/svelte/store.js";import{v4 as I}from"../../web_modules/uuid.js";import o from"../../web_modules/lodash/find.js";import c from"../../web_modules/lodash/remove.js";import l from"../../web_modules/lodash/cloneDeep.js";window.localStorage.getItem("cards")&&window.localStorage.clear();const u=()=>I(),_=JSON.parse(window.localStorage.getItem("lists"))||[],r=m(_);r.subscribe(e=>{window.localStorage.setItem("lists",JSON.stringify(e))});export let lists={subscribe:r.subscribe,reorder(e){const{oldIndex:d,newIndex:t}=e;r.update(s=>{const i=l(s[d]);return s.splice(d,1),s.splice(t,0,i),s})},add(e){const{title:d}=e;r.update(t=>(t.push({id:u(),title:d,cards:[]}),t))},edit(e){const{listId:d,title:t}=e;r.update(s=>{const i=o(s,{id:d});return i.title=t,s})},remove(e){const{listId:d}=e;r.update(t=>(c(t,{id:d}),t))}};export const cards={reorder(e){const{fromListId:d,toListId:t,oldIndex:s,newIndex:i}=e;r.update(n=>{const a=o(n,{id:d}),L=d===t?a:o(n,{id:t}),p=l(a.cards[s]);return a.cards.splice(s,1),L.cards.splice(i,0,p),n})},add(e){const{listId:d,title:t}=e;r.update(s=>{const i=o(s,{id:d});return i.cards.push({id:u(),title:t}),s})},edit(e){const{listId:d,cardId:t,title:s}=e;r.update(i=>{const n=o(i,{id:d}),a=o(n.cards,{id:t});return a.title=s,i})},remove(e){const{listId:d,cardId:t}=e;r.update(s=>{const i=o(s,{id:d});return c(i.cards,{id:t}),s})}};
